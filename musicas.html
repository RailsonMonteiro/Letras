<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Música</title>
<link rel='stylesheet' href='https://cdn-uicons.flaticon.com/2.6.0/uicons-regular-rounded/css/uicons-regular-rounded.css'>
<link rel="icon" sizes="32" href="icon-512.png" />
<style>
  html,body {
    height: 100%;
    font-family: Arial, sans-serif;
    margin: 0;
    background: #f0f2f5;
    color: #333;
  }

  .container {
    max-width: 800px;
    margin: 30px auto;
    background: #fff;
    padding: 25px;
    border-radius: 10px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.15);
    position: relative;
  }

  h1 { color: #007bff; margin-bottom: 10px; }
  h2 { color: #555; margin-bottom: 20px; }
  pre {
    white-space: pre-wrap;
    line-height: 1.5;
    margin-bottom: 15px;
  }
  .refrao {
    margin-top: 10px;
    padding: 10px;
    background: #f9f9f9;
    border-left: 4px solid #007bff;
    border-radius: 5px;
  }

  a {
    display: inline-block;
    text-decoration: none;
    color: #77818b;
    font-weight: bold;
    font-size: 20px;
  }
  a:hover { text-decoration: none; }

  footer {
    color: #77818b; 
    text-align: center;
    padding: 15px 0;
    font-size: 10px;
  }

  /* Player no topo do container */
  #playerBar {
    position: absolute;
    top: 10px;
    left: 10px;
    right: 70px;
    display: none;
    align-items: center;
    gap: 10px;
    z-index: 999;
  }
  #progress {
    flex: 1;
    height: 6px;
    background: #444;
    border-radius: 3px;
    overflow: hidden;
  }
  #progress span {
    display: block;
    height: 100%;
    width: 0;
    background: #28a745;
  }
  #time {
    color: #77818b;
    font-size: 12px;
  }

  /* Botões flutuantes */
  .btn-audio, .btn-pause, .btn-stop {
    position: fixed;
    margin-top: 20px;
    right: 17px;
    color: #007bff;
    border: none;
    border-radius: 30%;
    width: 40px;
    height: 40px;
    font-weight: bold;
    font-size: 15px;
    cursor: pointer;
    z-index: 1000;
    opacity: 0.7;
    transition: opacity 0.3s;
    text-align: center;
    align-items: center;
    display: flex;
    justify-content: center;
  }

  .btn-audio { top: 20px; }
  .btn-pause { top: 68px; }
  .btn-stop  { top: 118px; }

  .botoes{ padding: 2px; }
</style>
</head>
<body>
<div class="container">
  <!-- Player fixo -->
  <div id="playerBar">
    <div id="progress"><span></span></div>
    <div id="time">0:00 / 0:00</div>
  </div>
  <a href="index.html"><i class="fi fi-rr-undo">Voltar</i></a>
  <div id="musica"></div>
</div>

<div class="botoes">
  <button class="btn-audio">Play</button>
  <button class="btn-pause"><i class="fi fi-rr-play"></i></button>
  <button class="btn-stop"><i class="fi fi-rr-stop"></i></button>
</div>

<script>
async function carregarMusicas(){
  try {
    const resp = await fetch('musicas.json');
    if(!resp.ok) throw new Error('JSON externo não encontrado');
    return await resp.json();
  } catch(e) {
    return [
      {
        "id":1,
        "titulo":"Joyce",
        "artista":"Artista 1",
        "versos":"Verso 1\nVerso 2\nVerso 3",
        "refrao":"Refrão",
        "estilo":{"cor":"#333","tamanho":"16px","fonte":"Arial"},
        "estiloRefrao":{"cor":"red","tamanho":"20px","negrito":true}
      }
    ];
  }
}

(async ()=>{
  const musicas = await carregarMusicas();
  const params = new URLSearchParams(window.location.search);
  const id = parseInt(params.get("id"));
  const m = musicas.find(x=>x.id===id);
  const div = document.getElementById("musica");

  if(m){
    const estilo = m.estilo || {};
    const cssVersos = `
      color:${estilo.cor || '#333'};
      font-size:${estilo.tamanho || '16px'};
      font-family:${estilo.fonte || 'Arial'};
      font-weight:${estilo.negrito ? 'bold' : 'normal'};
      font-style:${estilo.italico ? 'italic' : 'normal'};
      text-decoration:${estilo.sublinhado ? 'underline' : 'none'};
    `;
    const estiloRefrao = m.estiloRefrao || {};
    const cssRefrao = `
      color:${estiloRefrao.cor || '#007bff'};
      font-size:${estiloRefrao.tamanho || '18px'};
      font-family:${estiloRefrao.fonte || 'Arial'};
      font-weight:${estiloRefrao.negrito ? 'bold' : 'normal'};
      font-style:${estiloRefrao.italico ? 'italic' : 'normal'};
      text-decoration:${estiloRefrao.sublinhado ? 'underline' : 'none'};
    `;

    div.innerHTML = `
      <h1>${m.titulo}</h1>
      <h2>${m.artista}</h2>
      <pre style="${cssVersos}">${m.versos || m.letra || ""}</pre>
      ${m.refrao ? `<pre class="refrao" style="${cssRefrao}">${m.refrao}</pre>` : ""}
    `;

    const btn = document.querySelector(".btn-audio");
    const btnPause = document.querySelector(".btn-pause");
    const btnStop  = document.querySelector(".btn-stop");

    let modo = "voz";
    const audio = new Audio();
    const playerBar = document.getElementById("playerBar");
    const progress = document.querySelector("#progress span");
    const time = document.getElementById("time");

    function tocar() {
      let arquivo = modo==="voz" ? `musicas/${m.titulo}-voz.mp3` : `musicas/${m.titulo}-pb.mp3`;
      btn.textContent = modo==="voz" ? "Voz" : "PB";
      audio.src = arquivo;
      audio.play();
      playerBar.style.display = "flex";
      btnPause.innerHTML = '<i class="fi fi-rr-pause"></i>';
    }

    btn.addEventListener("click", ()=>{
      if(!audio.paused){
        audio.pause();
        audio.currentTime = 0;
        modo = (modo==="voz" ? "pb" : "voz");
        tocar();
      } else {
        tocar();
      }
    });

    // Toggle Play/Pause
    btnPause.addEventListener("click", ()=>{
      if(audio.paused){
        audio.play();
        btnPause.innerHTML = '<i class="fi fi-rr-pause"></i>';
      } else {
        audio.pause();
        btnPause.innerHTML = '<i class="fi fi-rr-play"></i>';
      }
    });

    btnStop.addEventListener("click", ()=>{
      audio.pause();
      audio.currentTime = 0;
      progress.style.width = "0%";
      playerBar.style.display = "none";
      btnPause.innerHTML = '<i class="fi fi-rr-play"></i>';
    });

    audio.addEventListener("timeupdate", ()=>{
      if(audio.duration){
        let percent = (audio.currentTime / audio.duration) * 100;
        progress.style.width = percent+"%";
        let min = Math.floor(audio.currentTime / 60);
        let sec = Math.floor(audio.currentTime % 60).toString().padStart(2,"0");
        let minT = Math.floor(audio.duration / 60);
        let secT = Math.floor(audio.duration % 60).toString().padStart(2,"0");
        time.textContent = `${min}:${sec} / ${minT}:${secT}`;
      }
    });

    audio.addEventListener("ended", ()=>{
      progress.style.width = "0%";
      playerBar.style.display = "none";
    });

  } else {
    div.innerHTML="<p>Música não encontrada.</p>";
  }
})();
</script>

<footer> 
  Copyright © 2025 Railson Monteiro. Todos os direitos reservados.
</footer>
</body>
</html>
